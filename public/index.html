<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard - Clube de Vantagens</title>
<link rel="stylesheet" href="/assets/app.css">
</head>
<body>
<header>
  <nav>
    <a href="/">Dashboard</a>
    <a href="/admin/cadastro.html">Clientes &gt; Novo</a>
    <a href="/admin/assinatura.html">Assinaturas</a>
    <a href="/deploy-check.html">Status/Health</a>
  </nav>
  <div><label>PIN <input type="password" id="pin" class="pin-input"></label></div>
</header>
<main>
  <div id="msg"></div>
  <div class="cards">
    <div class="card"><h3>Clientes</h3><p id="m-clientes">-</p></div>
    <div class="card"><h3>Transações</h3><p id="m-transacoes">-</p></div>
    <div class="card"><h3>Bruto</h3><p id="m-bruto">-</p></div>
    <div class="card"><h3>Líquido</h3><p id="m-liquido">-</p></div>
  </div>
</main>
<script src="/assets/app.js"></script>
<script>
async function load(){
  const msg=document.getElementById('msg');
  App.clearAlert(msg);
  try{
    const [resumo, clientes]=await Promise.all([
      App.apiFetch('/admin/report'),
      App.apiFetch('/admin/clientes').catch(()=>null)
    ]);
    if(clientes) document.getElementById('m-clientes').textContent=clientes.length;
    document.getElementById('m-transacoes').textContent=resumo.totalTransacoes;
    document.getElementById('m-bruto').textContent=resumo.totalBruto;
    document.getElementById('m-liquido').textContent=resumo.totalLiquido;
  }catch(e){
    App.showAlert(msg,e.message,'error');
  }
}
document.addEventListener('DOMContentLoaded',()=>{
  App.attachPinInput(document.getElementById('pin'),load);
  load();
});
</script>
</body>
</html>
