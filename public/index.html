<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Clube de Vantagens</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <header class="header" role="banner">
      <a href="/" class="logo">Clube de Vantagens</a>
      <nav class="nav">
        <a href="/">Painel</a>
        <a href="/relatorios.html">Relatórios</a>
        <a href="/etiquetas.html">Etiquetas</a>
        <a href="/leads-admin.html">Leads (Admin)</a>
      </nav>
      <div class="header-actions">
        <div class="status">
          <span id="api-status" class="status-dot status-dot--warn"></span>
          <span id="api-status-text">instável</span>
        </div>
        <button id="btn-theme" class="btn btn--outline">⚙ Aparência</button>
        <button id="btn-settings" class="btn btn--ghost">⚙ Configurações</button>
      </div>
    </header>

    <main class="panel" id="main-content">
      <form id="form-transacao" novalidate>
        <section class="form-grid">
          <div class="field">
            <label for="cpf">CPF</label>
            <input id="cpf" class="input input--cpf" type="text" placeholder="000.000.000-00" inputmode="numeric" autocomplete="off" maxlength="14" />
            <small id="cpf-hint" class="hint">Digite 11 dígitos (modo manual) ou use o leitor/QR.</small>
          </div>

          <div class="field">
            <label for="valor">Valor</label>
            <div class="input-group">
              <span class="prefix">R$</span>
              <input id="valor" class="input input--money" type="text" placeholder="0,00" inputmode="decimal" autocomplete="off" />
            </div>
            <small class="hint">Use vírgula para centavos.</small>
          </div>
        </section>
        <div class="actions">
          <button type="button" id="btn-consultar" class="btn btn--primary">Consultar</button>
          <button type="button" id="btn-registrar" class="btn btn--outline">Registrar e Aplicar Desconto</button>
        </div>
      </form>

      <section id="resultado" class="card result">
        <div><span>Cliente:</span> <strong id="out-nome">—</strong></div>
        <div><span>Plano:</span> <strong id="out-plano">—</strong></div>
        <div id="row-desc" class="hidden"><span>Desconto Aplicado:</span> <strong id="out-desc">—</strong></div>
        <div id="row-valor" class="hidden"><span>Valor Final:</span> <strong id="out-valor">—</strong></div>
        <div><span>Status do Pagamento:</span> <strong id="out-status">—</strong></div>
        <div><span>Vencimento:</span> <strong id="out-venc">—</strong></div>
        <div id="row-tx" class="row-meta hidden">
          <span id="out-tx"></span>
        </div>
      </section>
    </main>
    <section class="panel">
      <h2>Leitores</h2>
      <div class="reader-modes">
        <label><input type="radio" name="reader-mode" value="manual"   id="mode-manual"  checked> Manual</label>
        <label><input type="radio" name="reader-mode" value="wedge"    id="mode-wedge"> Leitor (bipe)</label>
        <label><input type="radio" name="reader-mode" value="qr"       id="mode-qr"> QR Code</label>
        <span id="mode-badge" class="badge">modo: manual</span>
      </div>

      <div id="qr-controls" class="qr-controls hidden">
        <div class="grid">
          <label class="label" for="qr-camera">Câmera</label>
          <select id="qr-camera" class="input"></select>
        </div>
        <div class="actions">
          <button id="qr-start" class="btn btn--primary">Iniciar QR</button>
          <button id="qr-stop"  class="btn">Parar QR</button>
        </div>
        <div id="qr-reader" class="qr-reader"></div>
        <p class="hint">Aponte a câmera para o QR do CPF. Ao ler, a consulta acontece automaticamente.</p>
      </div>

      <p class="hint">
        • <strong>Leitor (bipe):</strong> aponte para a etiqueta do ID interno e bipar. <br>
        • <strong>QR Code:</strong> use a câmera do PC/celular para ler o QR do ID interno.
      </p>
    </section>

    <div id="toasts" class="toasts" aria-live="polite" aria-atomic="true"></div>

    <footer class="footer">
      <p>v0.1.0 — Ambiente de Teste — Loja X</p>
    </footer>
  </div>
  <dialog id="settingsDialog" class="settings-dialog">
    <form id="settingsForm">
      <select id="pref-readerMode">
        <option value="manual">Manual</option>
        <option value="wedge">Leitor (bipe)</option>
        <option value="qr">QR Code (câmera)</option>
      </select>
      <label><input type="checkbox" id="pref-autoConsultOnScan"> Auto-consultar ao ler</label>
      <label><input type="checkbox" id="pref-autoRegisterAfterConsult"> Auto-registrar após consultar</label>
      <label><input type="checkbox" id="pref-focusValueAfterConsult"> Focar no Valor após consultar</label>
      <label><input type="checkbox" id="pref-beepOnScan"> Beep ao ler</label>
      <label><input type="checkbox" id="pref-clearCpfAfterRegister"> Limpar CPF após registrar</label>
      <label><input type="checkbox" id="pref-keepValueAfterRegister"> Manter Valor após registrar</label>
      <label>Câmera (QR)
        <select id="pref-qrCameraId"><option value="">Padrão do navegador</option></select>
      </label>
      <label>Debounce do leitor (ms)
        <input type="number" id="pref-wedgeDebounceMs" min="0" step="10" value="40">
      </label>
      <label>Tamanho mínimo p/ disparo
        <input type="number" id="pref-scanMinLength" min="4" step="1" value="11">
      </label>
      <details><summary>Avançado</summary>
        <label>Padrão de ID interno (regex)
          <input type="text" id="pref-idPattern" value="^C\\d{7}$">
        </label>
      </details>
      <div class="card">
        <div class="row">
          <button type="button" id="btn-test-wedge" class="btn btn--outline">Testar leitor (bipe)</button>
          <button type="button" id="btn-test-qr" class="btn btn--outline">Testar QR</button>
        </div>
        <pre id="test-output" class="test-output" aria-live="polite"></pre>
      </div>
      <div class="row end">
        <button type="button" id="btn-reset-prefs" class="btn btn--ghost">Resetar padrão</button>
        <button type="button" id="btn-close-settings" class="btn btn--ghost">Fechar</button>
        <button type="submit" class="btn btn--primary">Salvar</button>
      </div>
    </form>
  </dialog>

  <script src="/libs/html5-qrcode.min.js" defer></script>
  <script src="/settings.js" defer></script>
  <script src="/main.js" defer></script>
</body>
</html>
